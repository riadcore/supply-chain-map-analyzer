{% extends "base.html" %}
{% block content %}

<h1 class="page-title">{{ upload.original_filename }}</h1>
<p class="page-subtitle">
  Uploaded on {{ upload.created_at.strftime('%Y-%m-%d %H:%M:%S') }}
</p>

<!-- ================= HEADER CARD ================= -->
<div class="card header-card">
  <h2>Exporter Name SUPPLY CHAIN MAP for Product #</h2>

  <div class="header-grid">
    <div>
      <div class="header-label">Vendor Number</div>
      <div class="header-value">{{ header.vendor_number }}</div>

      <div class="header-label">Item</div>
      <div class="header-value">{{ header.item }}</div>

      <div class="header-label">Item Number</div>
      <div class="header-value">{{ header.item_number }}</div>
    </div>

    <div>
      <div class="header-label">Ship Date</div>
      <div class="header-value">{{ header.ship_date }}</div>

      <div class="header-label">PO Quantity</div>
      <div class="header-value">{{ header.po_quantity }}</div>
    </div>

    <div>
      <div class="header-label">Component Breakdown</div>
      <table class="table compact">
        <thead>
          <tr>
            <th>Component</th>
            <th>%</th>
            <th>Origin</th>
          </tr>
        </thead>
        <tbody>
          {% for c in components %}
          <tr>
            <td>{{ c.name }}</td>
            <td>{{ c.percent }}</td>
            <td>{{ c.origin }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ================= FLOW DIAGRAM ================= -->
<h2 class="section-title">Supply Chain Flow Diagram</h2>

<div class="card">
  <div class="flow-container">
    {% for n in nodes %}
      <div class="node-card">

        <div class="node-material">{{ n.material }}</div>
        <div class="node-group">{{ n.group }}</div>

        <!-- LEFT BOX -->
        <div class="node-label">{{ n.left_type }}</div>
        <div class="node-text">{{ n.left_party }}</div>

        <hr>

        <!-- RIGHT BOX -->
        <div class="node-label">{{ n.right_type }}</div>
        <div class="node-text">{{ n.right_party }}</div>

        <hr>

        {% if n.date %}
          <div class="node-label">Date</div>
          <div class="node-text">{{ n.date }}</div>
        {% endif %}

        {% if n.quantity %}
          <div class="node-label">Quantity</div>
          <div class="node-text">{{ n.quantity }}</div>
        {% endif %}

        {% if n.documents %}
          <div class="node-label">Documents</div>
          <ul class="node-doc-list">
            {% for d in n.documents %}
              <li>{{ d }}</li>
            {% endfor %}
          </ul>
        {% endif %}

      </div>

      {% if not loop.last %}
        <div class="node-arrow">âžœ</div>
      {% endif %}
    {% endfor %}
  </div>
</div>

<!-- ================= DETAIL GRID STYLES ================= -->
<style>
  /* Horizontal scroll row for detailed records */
  .detail-grid {
    display: flex;
    flex-wrap: nowrap;      /* keep everything in one row */
    gap: 24px;
    overflow-x: auto;       /* horizontal scroll */
    padding-bottom: 10px;
  }

  .detail-card {
    flex: 0 0 350px;        /* fixed card width */
  }
</style>

<!-- ================= DETAILED SUPPLY CHAIN RECORDS ================= -->
<h2 class="section-title">Detailed Supply Chain Records</h2>

{% if details %}
  <div class="detail-grid">
    {% for b in details %}
      <div class="card detail-card" style="margin-top: 20px;">

        <!-- Block type e.g. Ginner, Spinner, Fabric Maker -->
        <h3>{{ b.type }}</h3>

        {% if b.name %}
          <p><strong>{{ b.name }}</strong></p>
        {% endif %}

        {% if b.location %}
          <p>{{ b.location }}</p>
        {% endif %}

        <!-- RECORD TITLE (e.g. Ginner Production Records) -->
        {% if b.doc_title %}
          <div style="font-weight: bold; margin-top: 10px; margin-bottom: 5px;">
            {{ b.doc_title }}
          </div>
        {% endif %}

        <!-- DOCUMENT LIST -->
        {% if b.documents %}
          <ul>
            {% for d in b.documents %}
              <li>{{ d }}</li>
            {% endfor %}
          </ul>
        {% endif %}

      </div>
    {% endfor %}
  </div>
{% else %}
  <p>No additional detailed records.</p>
{% endif %}

{% endblock %}
